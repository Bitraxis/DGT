<?xml version="1.1" encoding="UTF-8"?>
<?xml-stylesheet href="main.xsl" type="text/xsl"?>

<main>
    <name>Really Unique Different Open Learning Framework</name>
    <shortname>RUDOLF</shortname>
    <comment> A Learning-focused toolkit for great websites, without node! </comment>
    <version>dev-0.1</version>
</main>
<config>
    <biases>
        <bias name="pybiased">
            <framework>brython-first</framework>
        </bias>
        <bias name="jsbiased">
            <framework>javascript-first</framework>
        </bias>
    </biases>
    <set bias="pybiased"/> <!-- Set this to which approach you prefer, pybiased is the default -->
    <modules>
        <module>framework</module>
        <module>database</module>
        <module>ajax</module>
        <module>query</module>
        <module>styles</module>
        <module>path</module>
        <module>cms</module>
        <module>php</module>
        <module>asp</module>
        <module>dtd</module>
        <module>schema</module>
        <module>WSDL</module>
        <module>SOAP</module>
        <module>RDF</module>
        <module>RSS</module>
    </modules>
    <defaults>
        <!-- Bare Minimum Config (These need to stay-->
        <module>framework</module>
        <module>ajax</module>
        <module>query</module>
        <module>styles</module>
        <module>path</module>
        <module>dtd</module>
        <module>schema</module>
    </defaults>
    <!-- Extra Module Config Goes HERE!!-->
    <defined>
        <module>cms</module>
    </defined>
</config>

<!-- Init of the working dir -->
<files category="defaults">
    <if category="framework">
        <file>index.html</file>
        <folder name="assets">
            <folder name="css">
                <file>styles.css</file>
            </folder>
            <folder name="js">
                <file>scripts.js</file>
            </folder>
            <folder name="py">
                <file>main.py</file>
            </folder>
            <!-- The old rudolf folder now this one file-->
            <!--<folder name="rudolf">
                <folder name="base">
                    <file useCDN="true" populate="true">
                        <url name="rudolf-base">https://rudolf.edu/rudolf-base/assets/rudolf-base</url>
                    </file>
                </folder>
                <folder name="extras">
                    <file useCDN="true" populate="true">
                        <url name="rudolf-extras">https://rudolf.edu/rudolf-extras/assets/rudolf-extras</url>
                    </file>
                </folder>
            </folder>-->
        </folder>
    </if>
    <if category="ajax">
        <if category="php">
            <file>ajax_handler.php</file>
        </if>
        <if category="asp">
            <file>ajax_handler.asp</file>
        </if>
        <else>
            <if config="pybiased">
                <file>ajax_handler.py</file>
            </if>
            <if config="jsbiased">
                <file>ajax_handler.js</file>
            </if>
        </else>
    </if>
    <!-- All rights reserved to sql.js creators and contributors-->
    <if category="query">
        <if config="jsbiased">
            <wasm>
                <file>
                    <url name="sql.js-wasm">https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.13.0/sql-wasm.wasm</url>
                </file>
            </wasm>
            <script>
                <file>
                    <url name="sql.js">https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.13.0/sql-wasm.js</url>
                </file>
            </script>
        </if>
        <else>
            <config>
                <!-- Default setup: basic sessionStorage without anything-->
                <sessionStorage>true</sessionStorage>
                <localStorage>false</localStorage>
                <indexedDB>false</indexedDB>
                <useCookies>false</useCookies>
                <useJSON>false</useJSON>
                <useYAML>false</useYAML>
            </config>
            <if config="sessionStorage">
                <return>0</return>
                <pass></pass>
            </if>
            <if config="localStorage">
                <if config="useJSON">
                    <if config="pybiased">
                        <brython-import-definition>import json</brython-import-definition>
                    </if>
                    <else>
                        <return>$SCRIPT</return>
                        <pass></pass>
                    </else>
                </if>
                <if config="useYAML">
                    <if config="pybiased">
                        <brython-import-definition local="true" extPackageImport="true">import yaml</brython-import-definition>
                    </if>
                    <if config="jsbiased">
                        <es-import-definition useCDN="true" repo="*" extPackageImport="$if=[${extPackageVersion} >= ${repoPackageVersion}]">
                            <script get="${repoPackageVersion}" rank="true" defaultRepo="cdnjs">
                                <repo name="cdnjs">
                                    <url name="js-yaml">https://cdnjs.cloudflare.com/ajax/libs/js-yaml/*/js-yaml.min.js</url>
                                </repo>
                                <repo name="jsdelivr">
                                    <url name="js-yaml">https://cdn.jsdelivr.net/npm/js-yaml@*/dist/js-yaml.min.js</url>
                                </repo>
                                <repo name="unpkg">
                                    <url name="js-yaml">https://unpkg.com/js-yaml@*/dist/js-yaml.min.js</url>
                                </repo>
                                <!-- The RUDOLF package should be used as a last resort (may have older versions) -->
                                <repo name="extPackageImport">
                                    <rudolf-package version="${extPackageVersion}" reflect="true" static="false" >js-yaml</rudolf-package>
                                </repo>
                            </script>
                        </es-import-definition>
                    </if>
                </if>
                <else>
                    <if config="pybiased">
                        <brython-import-definition>from browser.local_storage import storage</brython-import-definition>
                        <if config="useCookies">
                            <brython-import-definition>from browser.cookies import cookies</brython-import-definition>
                        </if>
                    </if>
                    <!-- Javascript handles localStorage in your script so no extra definitions-->
                    <if config="jsbiased">
                        <return>$SCRIPT</return>
                        <pass></pass>
                    </if>
                </else>
            </if>
            <if config="indexedDB">
                <if config="useCookies">
                    <if config="pybiased">
                        <brython-import-definition>from browser.cookies import cookies</brython-import-definition>
                    </if>
                    <if config="jsbiased">
                        <return>$SCRIPT</return>
                        <pass></pass>
                    </if>
                </if>
                <else>
                    <if config="pybiased">
                        <brython-import-definition>import indexedDB</brython-import-definition>
                    </if>
                    <if config="jsbiased">
                        <return>$SCRIPT</return>
                        <pass></pass>
                    </if>
                </else>
            </if>
        </else>
    </if>
    <if category="styles">
        <file manage="true">assets/css/style.css</file>
        <config>
            <useModernCSS>true</useModernCSS> <!-- Enables some not yet fully implemented CSS features (don't worry rudolf will make it work) -->
            <!-- More Lobotomized PostCSS to ensure better compatibility -->
            <usePOSTCSS>
                <asterisk>
                    <engine>rudolf-postcss</engine> <!-- rudolf-postcss | autopostcss | autoprefixer | nextcss | tailwindcss (uses the runtime, don't expect tailwind features) -->
                    <configure>true</configure>
                    <compatibility>full</compatibility> <!-- full | partial (tailwindcss = to get some tailwind-like features) | none = not recommended as it breaks a lot of stuff you are on your own! -->
                    <postCSSFeature>50%</postCSSFeature> <!-- best results: 50% (rudolf-postcss / tailwindcss) | 75% (nextcss) | 100% (autopostcss) = warning problems will occur, make sure to disable ModernCSS -->
                </asterisk>
                <use>true</use>
            </usePOSTCSS>
            <useSASS>
                <asterisk>
                    <engine>rudolf-sass</engine> <!-- rudolf-sass | not-really-sass -->
                    <backend>dart-sass</backend> <!-- dart-sass (rudolf-sass) | node-sass (rudolf-sass) | ruby-sass (not-really-sass) | autosass (not-really & rudolf-sass) = experimental (hopefully soon the default)  -->
                    <configure> false </configure>
                    <compatibility> full </compatibility> <!-- full | partial | none = not-really-sass recommended when using ruby-sass backend -->
                    <sassFeature> 100%</sassFeature> <!-- best results: 100% (rudolf-sass) | 10% (not-really-sass only on ruby-sass | otherwise use 100% )  -->
                </asterisk>
                <use>false</use>
            </useSASS>
        </config>
    </if>
    <if category="path">
        <folder name="$ROOT">
            <manage>true</manage>
            <file>main.xquery</file>
        </folder>
    </if>
    <if category="dtd">
        <folder name="$ROOT">
            <manage>false</manage>
            <file>main.dtd</file>
        </folder>
    </if>
    <if category="schema">
        <folder name="$ROOT">
            <manage>false</manage>
            <file>main.xsd</file>
        </folder>
    </if>
</files>

<files category="defined">
    <if category="cms">
        <!-- All rights reserved to the SvelitaCMS team -->
        <useSveltia> true </useSveltia> <!-- The default CMS a replacement for DecapCMS / NetlifyCMS -->
        <useDecapCMS>false</useDecapCMS> <!-- The original in-html cms, now deprecated in favour of sveltia -->
        <useRudolfCMS><!-- The rudolf CMS, a SveltiaCMS compatible CMS, extremely configurable-->
            <engine>rudolf-compatible-cms</engine> <!-- rudolf-compatible-cms (the compat attempt) | rudolf-cms -->
            <configure>false</configure>
            <compatibility> full </compatibility> <!-- full (only rudolf-compatible-cms) | none (only rudolf-cms) -->
            <!-- You can mix and match -->
            <useJSON>false</useJSON>
            <useYAML>false</useYAML>
            <useXML>true</useXML> <!-- The rudolf way of configurations -->
            <!-- Want your cms to be styled and scripted, so here you go -->
            <useXSLT>true</useXSLT>
            <useXQuery>true</useXQuery>
            <useJS>true</useJS>
            <usePHP>false</usePHP>
            <use>false</use>
        </useRudolfCMS> 
    </if>
    <if category="database">
        <!-- deprecated in favour of query module, as this is very server dependent and rudolf is meant to be as serverless as possible -->
        <!-- All rights reserved to the Valkey, PostGresQL, MariaDB, SQLite teams -->
        <!-- The original ValkeyDB for in-browser database -->
        <useValkeyDB>
            <asterisk>
                <engine>valkeydb</engine> <!-- valkeydb | lovefield | lokijs | alasql | dexiejs -->
                <configure>true</configure>
                <compatibility>full</compatibility> <!-- full | partial | none = not recommended as it breaks a lot of stuff you are on your own! -->
                <valkeyDBFeature>100%</valkeyDBFeature> <!-- best results: 100% (valkeydb) | 75% (lovefield) | 50% (lokijs) | 25% (alasql) | 10% (dexiejs) -->
            </asterisk>
            <use>true</use>
            <if config="pybiased">
                <brython-import-definition local="true" extPackageImport="true" extImportFromJS="true">from rudolf.database import $asterisk.engine</brython-import-definition>
            </if>
            <if config="jsbiased">
                <es-import-definition useCDN="false" extPackageImport="true">
                    <script get="${repoPackageVersion}" rank="false" defaultRepo="extPackageImport">
                        <repo name="extPackageImport">
                            <rudolf-package version="${extPackageVersion}" reflect="true" static="false" >$asterisk.engine</rudolf-package>
                        </repo>
                    </script>
                </es-import-definition>
            </if>
        </useValkeyDB> 
        <usePostGresQL>false</usePostGresQL> <!-- The PostGresQL in-browser database, needs a server!!! -->
        <useMariaDB>false</useMariaDB> <!-- The MariaDB in-browser database, needs a server!!! -->
        <useSQLite>false</useSQLite> <!-- The SQLite in-browser database, needs a basic server at least.-->
    </if>
    <if category="php">
        <file>server_config.php</file>
        <file>
            <test test="exists">
                <file>index.html</file>
            </test>
            <if exists="false">
                <file>index.php</file>
            </if>
            <else>
                <rename>index.html = index.php</rename>
                
            </else>
        </file>
    </if>
</files>